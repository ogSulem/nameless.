from __future__ import annotations

import re

def normalize_city_name(name: str) -> str:
    if not name:
        return ""
    # Capitalize each part of the city name (e.g., "санкт-петербург" -> "Санкт-Петербург", "санкт петербург" -> "Санкт Петербург")
    parts = re.split(r'([ \-])', name.lower())
    normalized_parts = [p.capitalize() if p not in (' ', '-') else p for p in parts]
    return "".join(normalized_parts)

def _canonical_name(name: str) -> str:
    # Remove all non-alphanumeric characters and lowercase for comparison
    return re.sub(r'[^a-zа-я0-9]', '', name.lower())

# Hardcoded list of major CIS/Russian cities for basic validation
COMMON_CITIES_LIST = [
    "Москва", "Санкт-Петербург", "Новосибирск", "Екатеринбург", "Казань", "Нижний Новгород",
    "Челябинск", "Красноярск", "Самара", "Уфа", "Ростов-на-Дону", "Омск", "Краснодар",
    "Воронеж", "Пермь", "Волгоград", "Саратов", "Тюмень", "Тольятти", "Ижевск", "Барнаул",
    "Ульяновск", "Иркутск", "Хабаровск", "Махачкала", "Владивосток", "Ярославль", "Оренбург",
    "Томск", "Кемерово", "Новокузнецк", "Рязань", "Набережные Челны", "Астрахань", "Киров",
    "Пенза", "Севастополь", "Липецк", "Балашиха", "Чебоксары", "Калининград", "Тула",
    "Курск", "Ставрополь", "Сочи", "Улан-Удэ", "Тверь", "Магнитогорск", "Иваново",
    "Брянск", "Белгород", "Сургут", "Владимир", "Чита", "Архангельск", "Нижний Тагил",
    "Симферополь", "Калуга", "Якутск", "Грозный", "Волжский", "Смоленск", "Саранск",
    "Череповец", "Курган", "Подольск", "Вологда", "Орел", "Владикавказ", "Тамбов",
    "Мурманск", "Петрозаводск", "Нижневартовск", "Кострома", "Йошкар-Ола", "Новороссийск",
    "Стерлитамак", "Химки", "Таганрог", "Мытищи", "Сыктывкар", "Комсомольск-на-Амуре",
    "Нижнекамск", "Нальчик", "Шахты", "Дзержинск", "Энгельс", "Благовещенск", "Королев",
    "Братск", "Великий Новгород", "Орск", "Старый Оскол", "Ангарск", "Псков", "Люберцы",
    "Южно-Сахалинск", "Бийск", "Прокопьевск", "Абакан", "Армавир", "Балаково", "Норильск",
    "Рыбинск", "Северодвинск", "Петропавловск-Камчатский", "Красногорск", "Уссурийск",
    "Волгодонск", "Новочеркасск", "Сызрань", "Каменск-Уральский", "Златоуст", "Альметьевск",
    "Электросталь", "Керчь", "Миасс", "Салават", "Хасавюрт", "Пятигорск", "Копейск",
    "Коломна", "Майкоп", "Одинцово", "Ковров", "Железнодорожный", "Нефтеюганск",
    "Минск", "Гомель", "Могилев", "Витебск", "Гродно", "Брест", "Астана", "Алматы",
    "Шымкент", "Караганда", "Актобе", "Тараз", "Павлодар", "Усть-Каменогорск",
    "Семей", "Кызылорда", "Костанай", "Атырау", "Орал", "Петропавловск", "Бишкек",
    "Ош", "Ташкент", "Наманган", "Самарканд", "Андижан", "Нукус", "Бухара", "Карши",
    "Фергана", "Коканд", "Маргилан", "Душанбе", "Худжанд", "Ереван", "Гюмри", "Ванадзор",
    "Баку", "Гянджа", "Сумгаит", "Тбилиси", "Кутаиси", "Батуми"
]

CANONICAL_CITIES = { _canonical_name(city): city for city in COMMON_CITIES_LIST }

def is_valid_city(city: str) -> bool:
    return _canonical_name(city) in CANONICAL_CITIES

def get_canonical_city_name(city: str) -> str:
    # Returns the properly formatted name from our database
    return CANONICAL_CITIES.get(_canonical_name(city), normalize_city_name(city))

